#!/bin/bash
set -euo pipefail

# script args are passed to stow.
# - dry run: -nv
# - delete symlinks: -D
# - dry run deletion: -Dnv

cd ~/.dotfiles/packages
echo "pwd: $(pwd)"

# load all directories in cwd into packages
packages=()
for package in */; do
  packages+=("$(basename "$package")")
done

stow_args=(-t ~ --no-folding "$@" "${packages[@]}")
echo stow "${stow_args[@]}"

stow "${stow_args[@]}"

# remove bogus symlinks in ~/.config
find_args=(~/.config -type l ! -exec test -e {} \; -delete)
echo find "${find_args[@]}"
find "${find_args[@]}"
